---

copyright:
  years: 2017
lastupdated: "2017-6-22"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}

# 管理任务
{: #tasks_overview}

任务表示与软件部署关联的一些对业务有意义的活动。任务在部署计划中进行定义。

{:shortdesc}

大多数任务都有开始点和结束点，并有可度量的持续时间。任务可为以下某种类型：

<ul>
<li>**手动**任务可以表示与软件部署关联的任何活动，例如使服务器脱机或更新数据库。</li>
<li>**UrbanCode Deploy** 任务表示 IBM&reg; UrbanCode&reg; Deploy 应用程序。可以使用此任务类型运行 UrbanCode Deploy 应用程序。</li>
<li>**Continuous Delivery Pipeline** 任务表示 {{site.data.keyword.contdelivery_full}} Pipeline。可以使用此任务类型管理 {{site.data.keyword.contdelivery_short}} Pipeline。</li>
<li>**延迟**任务表示在特定时间发生的关键事件。</li>
<li>**头**任务是一种组织元素。例如，可使用头任务来标识任务组。</li>
<li>**电子邮件**任务在运行时会发送电子邮件消息。</li>
<li>**运行其他计划**任务为参与同一发布事件的其他部署计划运行部署。这是试验性任务类型。</li>
<l1>**Slack** 任务在运行时会向 Slack 通道发送消息。</l1>
</ul>

可以通过创建任务将任务添加到部署计划，也可以从 IBM UrbanCode Release 或其他应用程序创建的 CSV 文件导入任务。此外，还可以从其他部署计划复制任务。请参阅[导入任务](/docs/services/UCCR/UCCR_deployPlan.html#plan_importTasks)，以获取有关 CSV 文件格式的信息。

## 创建任务
{: #tasks_create}

创建任务时，选择要添加该任务的部署计划。缺省情况下，新任务会插入部署计划的底部。创建任务后，可以移动该任务，也可以将其复制并粘贴到其他部署计划中。[还可以创建与其他任务的依赖关系](/docs/services/UCCR/UCCR_tasks.html#tasks_dependencies)。

保存任务后，将显示该任务的操作图标。在部署期间，使用操作图标可更改任务的状态。所有任务都有**跳过**操作图标。其他图标（如**启动**）会在上下文合适时显示。

![](images/deploy-plan-intro.png "典型部署计划")

图 1. 简单部署计划与任务和操作按钮

部署计划中的每个任务都包含在单独一行中。下表中描述了为每个任务显示的信息。

### 表 1. 任务属性

| 属性| 描述|
| ------------------ | ------------------ |
| 名称               |任务名称|
| 类型               |任务类型：手动、UrbanCode Deploy、延迟、头|             
| 状态               |任务状态：未启动、完成、失败、已跳过、不适用|
| 所有者             |分配有该任务的人|
| 开始时间           |基于安排的启动或其他任务的估算持续时间所确定的开始时间或预期开始时间|
| 结束时间           |解决完任务的时间|
| 持续时间           |从任务启动到任务解决之间经过的时长（时间单位为分钟）|
| 依赖关系           |指示作为该任务先决条件的任务数和依赖于该任务的任务数|

---
将任务添加到部署计划后，可以通过多种方式对其进行管理。
要移动任务，请单击任务上的任意位置，并将其拖至新位置。

要复制任务或组，请选择该任务，并单击**复制** <img class="inline" src="images/copy-group.png"  alt="“复制”按钮">，然后将光标放在要插入所复制任务的位置，并单击**粘贴** <img class="inline" src="images/paste-group.png"  alt="“粘贴”按钮">。

要从部署计划中剪切任务或组，请选择该任务，然后单击**剪切** <img class="inline" src="images/cut-group.png"  alt="“剪切”按钮">。

要删除任务，请选择该任务，然后单击**删除** <img class="inline" src="images/trash-group.png"  alt="“删除”按钮">。任务会从部署计划中除去。

## 创建 UrbanCode Deploy 任务
{: #tasks_UDTasks}

UrbanCode Deploy 任务用于管理 UrbanCode Deploy 应用程序。运行 UrbanCode Deploy 任务时，关联的 UrbanCode Deploy 应用程序会使用该任务指定的进程、版本和环境来运行。可以在设计时设置版本和环境，也可以等到运行时进行选择。

部署期间，UrbanCode Deploy 任务在变得符合运行条件时会自动启动。   

**重要信息**：在 {{site.data.keyword.uccr_short}} 与 UrbanCode Deploy 集成后，应用程序会变为可用。可用于部署计划的应用程序取决于为该计划分配的团队。由 UrbanCode Deploy 中的团队管理的应用程序也在 {{site.data.keyword.uccr_short}} 中可用。

要创建 UrbanCode Deploy 任务，请完成以下任务。

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**之前选择任务。新任务会插入到所选任务的上方。

1. 在“创建任务”对话框的**类型**列表中，选择 **UrbanCode Deploy**。

1. 在**名称**字段中，输入任务的名称。

3. 在**持续时间（分钟）**字段中，输入您预期任务完成之前要运行的分钟数。估算持续时间用于计算预期部署时间。

3. 在**标记**列表中，将标记附加到任务。可以选择多个标记。要创建标记，请在列表的文本字段中输入标记名称。

3. 在**应用程序名称**列表中，选择应用程序。

3. 在**进程**列表中，选择应用程序进程。属于所选 UrbanCode Deploy 应用程序的进程可用。

3. 在**环境**列表中，选择应用程序环境。属于所选 UrbanCode Deploy 应用程序的环境可用。要延迟到准备好运行部署时再选择环境，请选择**使用版本选项卡**。

3. 在**版本**列表中，选择应用程序版本。版本是指 IBM UrbanCode Deploy 应用程序快照。属于所选应用程序的版本可用。要延迟选择版本，请选择**使用版本选项卡**。如果应用程序进程不需要版本，请选择**无版本**。如果要运行无需组件的配置类型进程，可选择此最后一个选项。

3. 在**已分配的组和用户**列表中，将任务分配给用户或组。已分配的用户会在部署期间运行任务。

3. 在**所有者**列表中，选择任务所有者。缺省所有者是创建任务的用户。将任务分配给用户或组后，会显示**所有者**列表。    

5. 单击**保存**。任务会插入到部署计划中。

创建任务后，计划的**版本**选项卡会使用有关分配给该任务的应用程序的信息进行更新。如果针对应用程序环境和版本选择了**使用版本选项卡**，请使用“版本”选项卡设置这两个选项后，再运行部署。

## 创建手动任务
{: #tasks_manual}

通常，手动任务表示与软件发布关联的某些活动，这类活动有开始点、结束点和可度量的持续时间。

要创建手动任务，请完成以下任务：

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**之前选择任务。新任务会插入到所选任务的上方。

1. 在“创建任务”对话框的**类型**列表中，选择**手动**。

1. 在**名称**字段中，输入任务的名称。

3. 在**持续时间（分钟）**字段中，输入您预期任务完成之前要运行的分钟数。估算持续时间用于计算预期部署时间。

3. 在**标记**列表中，将标记附加到任务。可以选择多个标记。要创建标记，请在列表的文本字段中输入标记名称。

3. 在**已分配的组和用户**列表中，将任务分配给用户或组。已分配的用户会在部署期间运行任务。

3. 在**所有者**列表中，选择任务所有者。缺省所有者是创建任务的用户。将任务分配给用户或组后，会显示**所有者**列表。    

5. 单击**保存**。任务会插入到部署计划中。

## 创建延迟任务
{: #tasks_delayed}

延迟类型的任务表示部署期间的里程碑或关键事件。使用延迟任务，可以确保重要任务在预期时间启动。通常，延迟任务是其他重要任务的先决条件。

延迟任务在符合运行条件后就会立即启动，并且会在用户指定的时间完成。启动的延迟类型任务的状态为`进行中`，直至其达到计划完成时间为止，在此时间后，其状态会更改为`完成`。延迟任务完成后，依赖于该任务的自动任务会开始运行。

要创建延迟任务，请完成以下任务：

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**之前选择任务。新任务会插入到所选任务的上方。

1. 在“创建任务”对话框的**类型**列表中，选择**延迟**。

1. 在**名称**字段中，输入任务的名称。

3. 在**时间**字段中，输入或选择将完成任务的时间。

3. 在**时区**列表中，为**时间**字段中输入的值选择时区。    

5. 单击**保存**。任务会插入到部署计划中。

## 创建头任务
{: #tasks_header}

头任务表示可以添加到部署计划的组织元素。如果创建了任务组，那么可使用头任务来标识该组。头任务可以像其他任何任务一样具有依赖关系。

从 IBM UrbanCode Release 导入部署计划时，分段任务由 note 类型的“开始分段”和“结束分段”任务括起来。分段依赖关系由对“结束分段”任务的依赖关系表示。

要创建头任务，请完成以下步骤：

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**之前选择任务。新任务会插入到所选任务的上方。

1. 在“创建任务”对话框的**类型**列表中，选择**头**。

1. 在**名称**字段中，输入任务的名称。此名称可表示任务组名称。

3. 在**描述**字段中，输入或粘贴描述。可在此字段中输入注释、提示或其他指示信息。

5. 单击**保存**。任务会插入到部署计划中。

## 创建 Continuous Delivery Pipeline 任务
{: #tasks_pipelineCD}

{{site.data.keyword.contdelivery_full}} Pipeline 会自动执行 DevOps 工作流程。管道是一序列阶段，用于检索输入和运行作业。可以使用管道任务管理 {{site.data.keyword.contdelivery_short}} Pipeline。Continuous Delivery Pipeline 任务是自动任务，在符合运行条件后就会立即运行。

要创建 Continuous Delivery Pipeline 任务，请完成以下步骤：

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**操作之前选择任务。新任务会插入到所选任务之前。

1. 在“创建任务”对话框的**类型**列表中，选择 **Continuous Delivery Pipeline**。

1. 在**名称**字段中，输入任务的名称。

3. 在**描述**字段中，输入或粘贴描述。可在此字段中输入注释、提示或其他指示信息。

3. 在**管道**字段中，输入或选择管道。

3. 在**阶段名称**字段中，输入或选择阶段名称。为所选管道定义的阶段可用。

3. 在**标记**列表中，将标记附加到任务。可以选择多个标记。要创建标记，请在列表的文本字段中输入标记名称。

3. 在**已分配的组和用户**列表中，将任务分配给用户或组。已分配的用户会在部署期间运行任务。

3. 在**所有者**列表中，选择任务所有者。缺省所有者是创建任务的用户。将任务分配给用户或组后，会显示**所有者**列表。    

5. 单击**保存**。任务会插入到部署计划中。

Continuous Delivery Pipeline 任务运行时，会运行所选管道的指定阶段上的作业。

## 创建电子邮件任务
{: #tasks_email}

电子邮件任务在运行时会发送电子邮件消息。创建此任务时，需要指定电子邮件的收件人和消息。电子邮件任务是自动任务，在符合运行条件后就会立即运行。

要创建电子邮件任务，请完成以下步骤：

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**操作之前选择任务。新任务会插入到所选任务之前。

1. 在“创建任务”对话框的**类型**列表中，选择**电子邮件**。

1. 在**名称**字段中，输入任务的名称。

3. 在**收件人**字段中，输入或选择电子邮件的收件人。可用收件人列表包含作为团队成员的用户和组。还可以输入非团队成员的电子邮件地址。可以指定多个收件人。

3. 在**电子邮件主题**字段中，输入电子邮件主题。

3. 在**电子邮件消息**字段中，输入或粘贴电子邮件消息。

5. 单击**保存**。任务会插入到部署计划中。

任务运行时，收件人会收到 **IBM Continuous Release** 发来的电子邮件，主题为您创建任务时所指定的主题。

## 创建“运行其他计划”任务
{: #tasks_runAnother}

“运行其他计划”任务用于为其他部署计划运行部署。目标计划必须通过模板进行创建。模板和目标计划必须与使用“运行其他计划”任务的计划位于同一发布事件中。

请注意，这是试验性任务类型。

要创建“运行其他计划”任务，请完成以下步骤：

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**操作之前选择任务。新任务会插入到所选任务之前。

1. 在“创建任务”对话框的**类型**列表中，选择**运行其他计划**。

1. 在**名称**字段中，输入任务的名称。

3. 在**计划模板名称**列表中，选择部署计划模板。模板必须与任务的父代计划位于同一发布事件中。

3. 在**标记**列表中，将标记附加到任务。可以选择多个标记。要创建标记，请在文本框中输入标记名称。

5. 单击**保存**。任务会插入到部署计划中。

任务运行时，会对通过所选模板创建且位于同一发布事件中的部署计划启动部署。如果发布事件中有多个计划是通过该模板创建的，那么会针对所有这些计划启动部署。其他部署运行时，“运行其他计划”任务会提供状态信息。展开任务可查看状态信息。可以使用任务上的链接来打开其他部署。其他部署运行时，“运行其他计划”任务的状态为**进行中**。

## 创建 Slack 任务
{: #tasks_slack}

Slack 任务在运行时会向 Slack 通道发送消息。消息可以包含文本和超链接。Slack 任务在符合运行条件后就会立即启动。

要创建 Slack 任务，请完成以下步骤：

1. 在“部署计划详细信息”页面上，单击**创建任务**。如果要在计划中的特定位置插入任务，请在使用**创建任务**操作之前选择任务。新任务会插入到所选任务之前。

1. 在“创建任务”对话框的**类型**列表中，选择 **Slack**。

1. 在**名称**字段中，输入任务的名称。

3. 在 **Webhook URL** 字段中，输入要将消息传递到的 Slack 通道的 URL，例如 `https://hooks.slack.com/services/my_webhook`。

3. 在**消息**框中，输入消息体。消息可以包含文本和超链接。

3. 在**持续时间（分钟）**字段中，输入您预期任务完成之前要运行的分钟数。估算持续时间用于计算预期部署时间。

3. 在**标记**列表中，将标记附加到任务。可以选择多个标记。要创建标记，请在文本框中输入标记名称。

3. 在**已分配的组和用户**列表中，将任务分配给用户或组。已分配的用户会在部署期间运行任务。

5. 单击**保存**。任务会插入到部署计划中。

任务运行时，“消息”字段中定义的消息会发送到 Webhook URL 字段中指定的 Slack 通道。

## 管理任务组
{: #tasks_groups}

可以将两个或更多任务组合成一个任务组。创建组时，可定义组的执行模式：顺序或并行。并行模式组中的任务可以按任意顺序运行，并且除非存在依赖关系，否则可以同时运行。顺序组中的任务按列表顺序执行，从第一个（即顶端的）任务开始。

可以将组嵌入到其他组中。您可以将顺序模式的组嵌入到并行模式的组中，反之亦然。但是，不能将顺序模式的组嵌入到其他顺序组中，也不能将并行模式的组嵌入到其他并行组中。  

要创建任务组，请完成以下步骤：

1. 在“部署计划详细信息”页面上，选择两个或更多任务。

1. 根据要创建的组的类型，完成以下某个步骤。

  <ul>
  <li>要创建并行组，请单击**并行**按钮 <img class="inline" src="images/para-icon.png"  alt="“并行组”按钮">。如果无法使用所选任务创建并行组，那么此按钮处于禁用状态。例如，如果所有所选任务都已经在并行组中，那么可能无法创建并行组。</li>
  <li>要创建顺序组，请单击**顺序**按钮 <img class="inline" src="images/seq-icon.png"  alt="“顺序组”按钮">。</li>
  </ul>

将构建组，并向部署计划添加**组选择栏**。如果选择了非连续的任务，那么这些任务会构成一个连续列表，从顶端所选任务开始。

下图显示了一个并行组。**组选择栏**会标识组的类型：并行 <img class="inline" src="images/para-select.png"  alt="选择并行组"> 或顺序 <img class="inline" src="images/seq-select.png"  alt="选择顺序组">。

![](images/group-select.png "典型部署计划")

图 2. 并行组

要移动组，请选择**组选择栏**，或单击该组上的任意位置，并将其拖至新位置。

要复制组，请选择该组，并单击**复制** <img class="inline" src="images/copy-group.png"  alt="“复制”按钮">，然后将光标放在要插入所复制组的位置，并单击**粘贴** <img class="inline" src="images/paste-group.png"  alt="“粘贴”按钮">。

要剪切组，请选择该组，然后单击**剪切** <img class="inline" src="images/cut-group.png"  alt="“剪切”按钮">。

要对组取消分组，请选择该组，然后单击**组选择栏**上的**取消分组**图标 <img class="inline" src="images/ungroup-icon.png"  alt="“取消分组”图标">。

要删除组中的任务，请选择该组，然后单击**删除** <img class="inline" src="images/trash-group.png"  alt="“删除”按钮">。任务会从部署计划中除去。

## 管理任务标记
{: #tasks_tags}

标记是可以添加到任务的组织元素。可以按标记来过滤部署计划。例如，在部署到生产环境期间，可禁用具有 `DEV_only` 标记的任务，这类任务仅用于开发环境。

要向任务添加标记，请完成以下步骤。

1. 在“部署计划详细信息”页面上，选择任务或任务组，然后单击**管理标记** <img class="inline" src="images/task-tag.png"  alt="管理标记">。可以选择多个任务和组。

1. 在“管理所选任务的标记”对话框的**常用标记**列表中，选择标记。可以通过在该列表的文本框中输入名称来创建新标记。

1. 单击**保存**。

标记会显示在“部署计划详细信息”页面中的任务行上。在下图中，**Deploy WAR** 任务分配有两个标记：`Deployment` 和 `Critical`。

部署计划使用的标记会显示在“部署计划详细信息”页面的**版本**选项卡上。要使带有特定标记的任务`不适用`于部署，请清除该标记。无法启动状态为`不适用`的任务。  

![](images/task-tag-labels.png "典型部署计划")

图 3. 任务依赖关系

## 创建任务依赖关系
{: #tasks_dependencies}

可以使一个任务成为其他任务的先决条件。如果某个任务是先决条件，那么在解决该先决条件任务之前，从属任务均无法启动，即便这些任务在其他方面符合启动条件也是如此。

一个任务可以有多个从属任务和多个先决条件任务。可以定义一个任务与部署计划中其他任何任务的依赖关系。但是，不能创建循环依赖关系。例如，不能使一个任务依赖于其本身依赖于第一个任务的任务。

通过控制任务依赖关系，可以确保事件按预期的顺序发生。

要使一个任务成为其他任务的先决条件，请完成以下步骤：

1. 在“部署计划详细信息”页面上，选择任务或任务组，然后单击**管理先决条件** <img class="inline" src="images/task-depend.png"  alt="任务先决条件">。可以选择多个任务和组。

1. 在“管理所选任务的先决条件”对话框的**所选任务的先决条件任务**列表中，选择先决条件任务。

1. 单击**保存**。

任务依赖关系会显示在“部署计划详细信息”页面上的**依赖关系**列中。向上箭头指示任务先决条件；向下箭头指示任务依赖关系。

在下图中，第一个任务没有任何先决条件，但有两个从属任务。第二个任务有一个先决条件任务，但没有任何从属任务。

(![](images/plan-w-depend.png "典型部署计划"))

图 4. 任务依赖关系

要查看或修改依赖关系，请选择任务，然后单击**管理先决条件** <img class="inline" src="images/task-depend.png"  alt="任务先决条件">。使用“管理所选任务的先决条件”对话框来修改或除去依赖关系。
