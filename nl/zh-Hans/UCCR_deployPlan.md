---

copyright:
 years: 2017
lastupdated: "2017-6-22"

---


<!-- Common attributes used in the template are defined as follows: -->
{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}

# 管理部署计划
{: #plan_overview}

部署计划是任务的容器。任务用于定义团队为了完成软件部署而运行的活动。

{:shortdesc}

通过分配要管理部署计划的团队，然后将任务添加到该计划来创建部署计划。在部署期间，团队成员将任务添加到计划并运行任务。管理团队还将确定哪些 IBM UrbanCode Deploy 应用程序可用。在使用 DevOps Connect 配置集成后，由 IBM UrbanCode Deploy 中的团队管理的所有应用程序在 {{site.data.keyword.uccr_short}} 中都可用。  

任务用于定义团队为了完成部署而执行的活动。可以创建新任务，从其他部署计划中复制任务或从 CSV 文件中导入任务。对计划感到满意后，即可安排部署。还可以通过启动计划的其中一个任务来随时运行部署。

部署计划中显示的每个任务独占一行。每行包含用于标识任务并提供其状态的信息。此外，每行还包含部署期间使用的操作图标，例如**启动**任务或**跳过**任务

缺省情况下，任务会从计划中的第一个任务（即顶端任务）开始按顺序运行。第一个任务完成后，第二个任务才符合运行条件，依此类推。任务符合运行条件的顺序称为执行顺序。

执行顺序可以通过将任务组合成组来进行修改。[创建组](/docs/services/UCCR/UCCR_tasks.html#tasks_groups)时，可设置组的执行模式，模式可以为顺序或并行。如果一个组具有顺序执行模式，那么其任务会从第一个任务开始按顺序运行。部署计划的缺省执行模式为顺序。如果一个组具有并行执行模式，那么该组中的任务可以按任意顺序启动并可同时运行。如果计划全部由并行任务组成，那么可以启动任意任务，与任务在列表中所处的位置无关。

任务是否符合条件还可能受任务依赖关系的影响。[如果任务具有任何先决条件](/docs/services/UCCR/UCCR_tasks.html#tasks_dependencies)，那么在解决所有先决条件任务之前，无法启动该任务，即便该任务在其他方面符合启动条件也是如此。

某些任务在符合运行条件后就会立即自动启动，而其他任务是手动启动的。任务是否自动启动取决于任务的类型。手动任务，顾名思义就是手动启动的任务。UrbanCode Deploy 和延迟类型的任务在符合启动条件后会立即自动启动。

符合条件的任务会显示**启动任务**按钮。要开始部署，请启动计划中的其中一个符合启动条件的任务。如果符合启动条件的任务是可以自动启动的类型（例如，UrbanCode Deploy），那么安排的部署会按安排的时间自动启动。

## 创建部署计划
{: #plan_create}
可以从没有定义任务的空白计划开始，也可以复制现有计划。另外还可以从计划模板开始。复制计划或使用模板时，已经定义了许多任务。

要创建部署计划，请完成以下步骤：

1. 在“发布”页面或“发布详细信息”页面上，单击**创建部署计划**。

2. 在“创建部署计划”窗口的**模板**列表中，指定要将计划基于的模板。缺省值为**无**。

2. 在**计划名称**字段中，输入计划名称。

3. 在**团队**列表中，选择要管理计划的团队。您所属的所有团队均可用。团队成员可以修改计划和管理任务。由 UrbanCode Deploy 中的团队管理的 UrbanCode Deploy 应用程序可供分配给 UrbanCode Deploy 类型的任务。

4. 要为计划安排部署，请单击**开始时间**，然后选择部署的日期和时间。如果计划包含符合启动条件的自动任务，那么安排的部署会按安排的时间自动启动。可以将部署安排在未来任意时间启动。

5. 在**发布**列表中，选择要将计划添加到的发布。属于您的其中一个团队的发布均可用。如果选择了发布，部署计划会显示在“发布详细信息”页面上。

6. 单击**保存**。如果在“发布详细信息”页面上创建了计划，那么该计划会成为所选发布的一部分。

保存计划后，单击**编辑**可修改计划详细信息。

## 将任务导入到部署计划
{: #plan_importTasks}

可以将通过逗号分隔值 (CSV) 文件定义的任务导入到部署计划。可以使用从 IBM UrbanCode Release 导出的 CSV 文件，也可以使用能够创建 CSV 文件的其他应用程序。

**重要信息**：导入任务时，CSV 文件中的任务会覆盖并替换已经在部署计划中定义的任务。

要将任务导入到部署计划，请完成以下步骤：

1. 在“部署计划详细信息”页面上，单击**导入任务**。

3. 在“导入任务”对话框中，单击**选择文件**，然后选择 CSV 文件。还可以将文件拖入到**选择文件**字段。

6. 单击**导入**。任务将添加到部署计划中。如果导入过程失败，请单击**查看报告**以显示错误日志。

从 IBM UrbanCode Release 导入部署计划时，分段会转换成组，且执行模式与原始分段相同。分段任务由 note 类型的“开始分段”和“结束分段”任务括起来。任务依赖关系会在导入期间保留。分段依赖关系由对“结束分段”任务的依赖关系表示。

下表包含用于在 IBM UrbanCode Release 部署计划中定义任务的字段。CSV 文件中的第一行包含列标题，对应于该表的**字段**列。第一行后面的各行包含任务数据，每行一个任务。列的顺序无关紧要。

要了解从 IBM UrbanCode Release 导出的部署计划的信息，请从“导入任务”对话框中下载 `SamplePlan.csv` 文件。

如果要在 CSV 文件中创建任务，必须包含下表中用星号字符 (*) 标识的必填字段。

| 字段| 描述|
| ------------------ |------------------|
|segmentName*                 |名称分段。必填字段。|                                                    
|name*                        |部署任务的名称。必填字段。|                                                                
|type*                        |任务类型。可能的值为 `note`、`waitfortimetask`、`ucdtask` 或 `manual`。导入期间，如果此字段包含无法识别的值，那么会为任务分配 manual 类型。|
|description                 |部署计划的描述。|                                                                                                    
|property:processId           |IBM UrbanCode Deploy 中对应于任务的进程标识。|
|property:task-environments   |可供任务使用的应用程序环境。|
|property:mailRecipients|发送通知时，接收电子邮件消息的用户的电子邮件地址。|
|taskTagNames                 |与任务关联的标记的名称。|
|taskPrequisiteIds         |启动此任务之前必须完成的任务的逗号分隔标识列表。|
|segmentPrerequisitelds       |当前分段对其有依赖关系的分段的逗号分隔标识列表。|
|taskPrequisiteNames         |启动此任务之前必须完成的任务的逗号分隔名称列表。|
|segmentPrerequisiteNames       |当前分段对其有依赖关系的分段的逗号分隔名称列表。|
|assignedUserEmail                |分配给当前任务的用户的电子邮件地址。|
|executorGroup                |分配给当前任务的用户组。|
|segmentPattern                |所选分段的执行模式。|

{: caption="表 1. IBM UrbanCode Release 部署计划字段" caption-side="top"}

## 复制和升级部署计划
{: #plan_copyPromote}

可以通过升级和复制操作来复制部署计划。复制或升级的计划的状态为`草稿`，即便原始计划的状态为`完成`或`进行中`也是如此。

要复制计划，请使用“部署计划”页面上的**复制此计划**操作。复制计划时，会在“部署计划”页面中插入名称为“`plan_name` 副本”的新计划。复制的计划包含原始计划中定义的所有任务。如果 UrbanCode Deploy 任务位于计划中，那么在复制的计划中还会选择原始计划中所选的应用程序、版本和环境。应用程序、版本和环境会显示在“部署计划详细信息”页面的**版本**选项卡上。

要升级计划，请使用“部署计划”页面上的**升级此计划**操作。升级计划时，会在“部署计划”页面中插入名称为“`plan_name` 升级”的新计划。升级的计划包含原始计划中定义的所有任务。如果 UrbanCode Deploy 任务位于该计划中，那么在升级的计划中还会选择原始计划中所选的应用程序和版本。复制的计划与升级的计划之间的差异在于升级的计划中未设置应用程序版本。

## 管理计划模板
{: #plan_templates}

可以转换部署计划以创建部署计划模板。

要创建模板，请使用“部署计划”页面上的**将此计划设置为模板**操作。创建模板时，会在“部署计划”页面中插入名称为“plan_name 副本”的新计划。模板的状态为`模板`，即便原始计划的状态为`完成`或`进行中`也是如此。模板包含原始计划中定义的所有任务。如果 UrbanCode Deploy 任务位于该计划中，那么在模板中还会选择原始计划中所选的应用程序。

不能使用模板来运行部署。要将模板用于部署，请首先对其进行复制或升级，然后使用复制或升级的计划。

## 归档部署计划
{: #plan_arch}

将部署计划放入归档时，该计划的状态为`已归档`，并且除非使用**归档**过滤器，否则该计划不会显示在“部署计划”页面中。

位于归档中的部署计划可以复原为`草稿`状态。不能永久删除部署计划。

## 还原和复原
{: #plan_history}

系统会保留每个部署计划的更改和修订版历史记录。可以在“部署计划详细信息”页面的**更改历史记录**选项卡上显示修订版。

要还原为先前的计划版本，请对要复原的版本使用**复原**操作 <img class="inline" src="images/restore-icon.png"  alt="复原操作">。该计划会复原为所选版本。  

## 估算部署时间
{: #plan_durationEst}

开始部署之前，可以估算其预期持续时间。要估算持续时间，请使用“部署计划详细信息”页面上的**估算任务时间**操作。显示的时间表示当您现在开始部署时部署结束的时间。
